(function(e){var a=false;var t={selector:null,append:false,url:null,action:null,method:"GET",getUrl:function(){var a=location.pathname.substring(0,location.pathname.lastIndexOf("/")+1);var t="";if(this.url&&this.url.indexOf("./")==0){t=a+this.url.substring(1)}else if(this.url&&this.url.indexOf("/")!=0){t=a+this.url}else if(this.url==undefined||this.url==null||e.trim(this.url)==""){t=location.href}else{t=this.url}return t},params:new Object,colModel:[],multiselect:true,multikey:"ctrlKey",multiboxonly:false,onSelectAll:null,onSelectRow:null,sortname:null,sortorder:null,defsort:"asc",onSort:null,rowClass:"active",selector:e(this).selector,callback:null,dataCallback:null,sort:function(a,t){return i.call(this,e(this.selector),a,t)},load:function(e,a){return n.call(this,e,a)},append:function(e,a,t){l.call(this,e,a,t)},onLoad:null,pager:"#pagination",page_id:"#pagination",pagekey:"page",page_mode:0,page:{cur_page:1,page_size:10,record_count:0,page_count:0},emptyrecords:'<i class="fa fa-exclamation-circle"></i>没有符合条件的记录',go:function(a,t,s){if(!t){t=this.page_size}r.call(this,e(this.selector),a,t,s)},firstPage:function(e){this.go(1,this.page_size,e)},lastPage:function(e){this.go(this.page_count,this.page_size,e)},prePage:function(e){var a=1;if(this.cur_page>1){a=this.cur_page-1}this.go(a,this.page_size,e)},nextPage:function(e){var a=1;if(this.cur_page<this.page_count){a=this.cur_page+1}this.go(a,this.page_size,e)},remove:function(e){o.call(this,e)},ajax:function(e){d.call(this,e)},reset:function(a,t,s){if(a!=undefined&&a!=null){if(t==undefined){t=false}if(t==true){if(s){var i=e(e.parseHTML(a)).find(s).html();e(this.selector).find(s).append(i)}else{e(this.selector).append(a)}}else{e(this.selector).replaceWith(a).remove()}var r=e(this.selector).tablelist(this);e.extend(true,this,r);e.tablelists(this.page_id,this)}return this},checkedValues:function(){var a=[];e(this.selector).find(".table-list-checkbox").each(function(){if(e(this).is(":checked")){a.push(e(this).val())}});return a}};e.tablelists=function(a,t){if(t==undefined){if(e("body").data("tablelists")&&a!=undefined){return e("body").data("tablelists")[a]}return e("body").data("tablelists")}if(!e("body").data("tablelists")){e("body").data("tablelists",{})}e("body").data("tablelists")[a]=t};e.fn.tablelist=function(a){t.selector=e(this).selector;t=e.extend(true,t,a);var i=e.extend({},t);s.call(e(this).get(0),e(this).get(0),i);e.tablelists(t.page_id,i);return i};function s(a,t){e(a).data("tablelist",t);if(t.multiselect){e(a).find("tr").each(function(a){e(this).find("th:first").find(":checkbox").addClass("table-list-checkbox-all").attr("title","全选/全不选");if(e(this).parents("tfoot").size()==0){e(this).find("td:first").find(":checkbox").addClass("table-list-checkbox")}else{e(this).find("td:first").find(":checkbox").addClass("table-list-checkbox-all").attr("title","全选/全不选")}if(t.multiboxonly==false){if(t.multikey=="ctrlKey"||t.multikey=="shiftKey"||t.multikey=="altKey"){e(this).click(function(a){if(a[t.multikey]){var s=e(this).find("td:first").find(":checkbox");if(s){s.click()}}})}}});e(".table-list-checkbox").click(function(){if(e(".table-list-checkbox:checked").size()==e(".table-list-checkbox").size()){e(".table-list-checkbox-all").prop("checked",true);e(this).parents("tr").attr("data-selected",true)}else{e(".table-list-checkbox-all").prop("checked",false);e(this).parents("tr:first").removeAttr("data-selected")}if(e(this).is(":checked")){e(this).parents("tr").addClass(t.rowClass)}else{e(this).parents("tr").removeClass(t.rowClass)}if(e.isFunction(t.onSelectRow)){var a=new Array;e(".table-list-checkbox:checked").each(function(){a.push(e(this).val())});var s=e(this).val();var i=e(this).is(":checked");t.onSelectRow(s,i)}});e(".table-list-checkbox-all").click(function(a){var s=e(this).is(":checked");e(".table-list-checkbox-all").prop("checked",s);e(".table-list-checkbox").prop("checked",s);if(e(this).is(":checked")){e(".table-list-checkbox").parents("tr").addClass(t.rowClass)}else{e(".table-list-checkbox").parents("tr").removeClass(t.rowClass)}if(e.isFunction(t.onSelectAll)){var i=new Array;e(".table-list-checkbox:checked").each(function(){i.push(e(this).val())});t.onSelectAll(i,s)}})}e(a).find("[data-sortname]").each(function(){var s=e(this).attr("data-sortname");if(s.length==0){e(this).css({cursor:"default"});return}e(this).css({cursor:"pointer"});var r=e(this).text();if(s==t.sortname&&t.sortorder!=null){e(this).html(r+"<span class='sort "+t.sortorder+"'></span>");if(t.sortorder=="desc"){e(this).attr("data-sortorder","asc")}else{e(this).attr("data-sortorder","desc")}}else{e(this).html(r+"<span class='sort'></span>");var l=e(this).attr("data-sortorder");if(!l||l.toLowerCase()!="asc"&&l.toLowerCase()!="desc"){e(this).attr("data-sortorder",t.defsort)}}e(this).click(function(){var s=e(this).attr("data-sortname");var r=e(this).attr("data-sortorder");i.call(t,a,s,r)})});e(a).find("tr:first>th").mouseover(function(){e(this).addClass("active");var a=e(this).attr("data-sortname");var t=e(this).attr("data-sortorder");if(a!=null){e(this).css({cursor:"pointer"})}else{e(this).css({cursor:"default"})}}).mouseout(function(){var a=e(this).attr("data-sortname");if(a==null||a==""||a!=t.sortname){e(this).removeClass("active")}});e(a).find("tr:first>th>span").mouseover(function(e){return true}).mouseout(function(e){return true});e(a).find("span.table-editor").css("cursor","pointer");e(a).find("span.table-editor").attr("title","点击进行编辑");e(a).find("span.table-editor").click(function(){if(e(this).data("editor-mode")){return}var a=e(this).data("editor-type");if(a==undefined){a="text"}var t=e.trim(e(this).html());e(this).data("editor-value",t);var s=null;if(a=="text"){s=e('<input type="text" class="form-control small" />')}else if(a=="textarea"){s=e('<textarea class="form-control ipt"></textarea>')}else if(a=="select"){var i='<select class="form-control">';if(e(this).data("editor-items")){try{var r=e.parseJSON(e(this).data("editor-items"));for(var l in r){i+='<option value="'+l+'">"'+r[l]+'"</option>'}}catch(n){console.error(n)}}i+="</select>";s=e(i)}s.val(t);e(this).html("");e(this).append(s);e(s).focus();var c=this;e(s).blur(function(){var a=e(c).data("editor-value");var t=e.trim(e(this).val());var s=e(c).data("editor-callback");if(s&&e.isFunction(s)){s.call()}e(c).html(t);e(c).data("editor-mode",false)});e(this).data("editor-mode",true)});if(t.page_mode==2){e(t.page_id).find("[data-go-page]").each(function(){if(e(this).is(":disabled")){return}var a=e(this).data("go-page");var s=t.getUrl();if(s.indexOf("?")!=-1){var i=s.substring(s.indexOf("?")+1);i=i.split("&");if(s.indexOf("page[cur_page]=")!=-1){for(var r=0;r<i.length;r++){var l=i[r].split("=")[0];if(l=="page[cur_page]"){i[r]="page[cur_page]="+a;is_exist=true}}}else{i.push("page[cur_page]="+a)}i=i.join("&");s=s.substring(0,s.indexOf("?"))+"?"+i}else{s=s+"?page[cur_page]="+a}e(this).attr("href",s)})}else{e(t.page_id).find("[data-go-page]").click(function(){if(e(this).is(":disabled")){return}var s=e(this).attr("data-go-page");if(t.page_mode==1){t.go(s)}else{r.call(t,a,s)}})}var s=e(t.page_id).find("[data-page-json]").html();if(s){var l=e.parseJSON(s);t.cur_page=l.cur_page;t.page_count=l.page_count;t.record_count=l.record_count;t.page_size=l.page_size;t.pagekey=l.page_key;t.page=e.extend(true,t.page,l);if(l.record_count==0&&t.emptyrecords!=false){var o=e(a).find("thead").find("th").size();var u='<tr><td class="no-data" colspan="'+o+'">'+t.emptyrecords+"</td></tr>";e(a).find("tbody").html(u)}e("[data-total-record]").html(l.record_count)}e(t.page_id).find("[data-page-size]").change(function(){var a=e(this).val();var s={page:{cur_page:1,page_size:a,page_id:t.page_id,page_size_list:t.page.page_size_list}};n.call(t,s)});e("span.ico-switch[data-action]").click(function(){var a=e(this).data("ajax");if(a){a.abort()}var s=e(this).attr("data-action");var i=e(this).attr("refresh");if(s==""){return false}var r=location.pathname.substring(0,location.pathname.lastIndexOf("/")+1);var l="";if(s&&s.indexOf("./")==0){l=r+s.substring(1)}else if(s&&s.indexOf("/")!=0){l=r+s}else if(s==undefined||s==null||e.trim(s)==""){l=r+s}else{l=s}var n="GET";var o=e(this).attr("data-params");if(o){o=e.parseJSON(o);if(!o["_csrf"]){o._csrf=e("[name='_csrf']:first").val()}n="POST"}else{o={}}var u=this;a=d({url:l,type:n,data:o,success:function(a){if(a.code==0){var s=a.data;c(e(u),s)}else if(a.message){if(e.isFunction(e.msg)){e.msg(a.message,{icon:"error"})}else{alert(a.message)}}f.call(t,a);e.loading.start();if(i==1){e.go(window.location.href)}}}).always(function(){e.loading.stop()});e(this).data("ajax",a)})}function i(t,s,i){if(a){return}var r=this;r.sortname=s;r.sortorder=i;a=true;var l=e(t).find("[data-sortname='"+s+"']");if(l.size()>0){e(l).siblings("[data-sortname]").find("span").removeClass("asc").removeClass("desc");e(l).html(e(l).text()+"<span class='sort "+i+"'></span>")}if(!r.params){r.params=new Object}var c={sortname:s,sortorder:i,page:{cur_page:r.page.cur_page?r.page.cur_page:1,page_size:r.page.page_size?r.page.page_size:10,page_id:r.page_id,page_size_list:r.page.page_size_list}};return n.call(r,c)}function r(e,t,s,i){if(a){return}var r=this;var l={page:{cur_page:t?t:1,page_size:s?s:r.page.page_size,page_id:r.page_id,page_size_list:r.page.page_size_list}};if(r.page_mode==2){var c=t;if(isNaN(c)){c=1}var o=r.getUrl();if(o.indexOf("?")!=-1){var l=o.substring(o.indexOf("?")+1);l=l.split("&");if(o.indexOf("page[cur_page]=")!=-1){for(var d=0;d<l.length;d++){var f=l[d].split("=")[0];if(f=="page[cur_page]"){l[d]="page[cur_page]="+c;is_exist=true}}}else{l.push("page[cur_page]="+c)}l=l.join("&");o=o.substring(0,o.indexOf("?"))+"?"+l}else{o=o+"?page[cur_page]="+c}window.location.href=o}else{if(r.page_mode==1){}else{n.call(r,l,i)}}}function l(e,a,t){var s=this;n.call(this,e,a,true,t)}function n(t,s,i,r){var l=this;l.params[l.pagekey]={page_id:l.page_id,cur_page:l.page.cur_page,page_size:l.page.page_size,page_size_list:l.page.page_size_list};var n={url:l.getUrl(),method:l.method,callback:l.callback};if(e.isFunction(s)){s={callback:s}}s=e.extend(true,n,s);if(l.sortname){l.params["sortname"]=l.sortname}if(l.sortorder){l.params["sortorder"]=l.sortorder}if(i){l.params["showloading"]=false}else{l.params["showloading"]=true}l.params=e.extend(true,l.params,t);a=true;return d.call(l,{url:s.url,type:s.method,data:l.params,success:function(e){if(e.code==0){l.reset(e.data,i,r)}f.call(l,e,s.callback)}}).done(function(e){a=false})}function c(a,t){var s=e(a).attr("data-value");if(s){try{s=e.parseJSON(s)}catch(i){}}var r=e(a).attr("data-label");if(r){try{r=e.parseJSON(r)}catch(i){}}var l=e(a).attr("data-class");if(l){try{l=e.parseJSON(l)}catch(i){}}if(t==undefined){t=e(a).attr("value")}if(s&&r&&l){if(e(a).hasClass("open")){e(a).removeClass("open")}else{e(a).addClass("open")}var n;var c;e.each(s,function(s,i){if(t==i){n=s;e(a).attr("value",i);return false}});var o=r[n];var d=l[n];e(a).html("<i class='"+d+"'></i>"+o)}}function o(t){var s=this;var i={warning:0,success:1,error:2,info:0};var r={url:o,type:"POST",data:{},dataType:"json",success:function(r){if(r.code==0){var l=r.data;var n=r.data&&r.data.icon&&i[r.data.icon]?i[r.data.icon]:1;s.load({},{callback:function(e){f.call(s,r,t.callback)}});if(r.message&&e.trim(r.message)!=""){if(e.isFunction(e.msg)){e.msg(r.message,{icon:n})}else{alert(r.message)}}}else if(r.message){f.call(s,r,t.callback);if(e.isFunction(e.alert)){var n=r.data&&r.data.icon&&i[r.data.icon]?i[r.data.icon]:2;e.alert(r.message,{icon:n})}else{alert(r.message)}}a=false}};t=e.extend(true,r,t);if(t.type.toLowerCase()=="post"&&t.data["_csrf"]==undefined){if(e("[name='_csrf']").size()>0){t.data["_csrf"]=e("[name='_csrf']:first").val()}else{var l=e.getCsrfParam();var n=e.getCsrfToken();t.data[l]=n}}var c=location.pathname.substring(0,location.pathname.lastIndexOf("/")+1);var o=t.url;if(o&&o.indexOf("./")==0){o=c+o.substring(1)}else if(o&&o.indexOf("/")!=0){o=c+o}else if(o==undefined||o==null||e.trim(o)==""){o=c+o}var u=t.confirm;if(u==undefined){if(a){return}d.call(s,t)}else{if(e.isFunction(e.confirm)){e.confirm(u,{icon:3},function(e){d.call(s,t)})}else if(u(u)){d.call(s,t)}}}function d(t){var s={type:"GET",async:true,dataType:"json",error:function(t,s,i){a=false;try{var r=e.parseJSON(t.responseText);if(r&&r.message){e.msg(r.message)}}catch(l){e.msg("失败"+t.status)}}};t=e.extend(true,s,t);if(this&&e.isFunction(this.dataCallback)){t.data=this.dataCallback(t.data)}if(t.type.toLowerCase()=="post"&&t.data["_csrf"]==undefined){if(e("[name='_csrf']").size()>0){t.data["_csrf"]=e("[name='_csrf']:first").val()}else{var i=e.getCsrfParam();var r=e.getCsrfToken();t.data[i]=r}}if(t.data["showloading"]==true){e.loading.start()}return e.ajax(t).always(function(){e.loading.stop()})}function f(a,t){var s=this;if(e.isFunction(t)){t.call(s,a)}else if(e.isFunction(s.callback)){s.callback.call(s,a)}e.loading.stop()}e.getCsrfParam=function(){return e("meta[name=csrf-param]").attr("content")};e.getCsrfToken=function(){return e("meta[name=csrf-token]").attr("content")}})(jQuery);