(function($){if($.validator==undefined){return}var pub={isEmpty:function(e){return e===null||e===undefined||e==[]||e===""}};var deferredArray=function(){var e=[];e.add=function(e){this.push(new $.Deferred(e))};return e};$.validator.setDefaults({errorPlacement:function(e,t){var r=$(e).attr("id");var a=$(e).text();var i=$(e).attr("for");if($.trim(a).length==0){return}var n=$('<span id="'+r+'" data-error-id="'+r+'" class="form-control-error"><i class="fa fa-warning"></i>'+a+"</span>");$(n).click(function(){$(t).focus()});var s=$(t).parents(".form-control-box");if($(s).size()>0){if($(s).first().parent().find(".form-control-error").size()>0){$(s).first().parent().find(".form-control-error").replaceWith(n)}else{$(s).first().after(n)}return}var l=null;if($(t).parents("form").size()>0){l=$(t).parents("form").find("[id='"+r+"']")}else{l=document.getElementById("[id='"+r+"']")}if($(l).size()>0){if($(l).text()==a){return}$(l).remove()}if($(t).is(":file")){$(t).parent().parent().after(n).attr("style","float: left;")}else if($(t).prop("tagName")=="SELECT"&&$(t).hasClass("chosen-select")){if($(t).data("chosen")&&$(t).data("chosen").container){$($(t).data("chosen").container).css("float","left")}$(t).after(n)}else{$(t).after(n)}},event:"keyup",debug:false,ignore:"",errorClass:"error",focusInvalid:true,onkeyup:function(e,t){var r=this.settings.rules[$(e).attr("name")];if(!(r&&r["default"])){$(e).valid()}},onfocusout:function(e){$(e).valid()},success:function(e){var t=$(e).attr("id");var r=$(e).attr("for");$("[id='"+t+"']").remove()},deferreds:deferredArray()});$.validator.showError=function(e,t){var r=$(e).attr("id");var a=$("<label>").attr("id",r+"-error").addClass("error").html(t||"");$.validator.defaults.errorPlacement(a,e)};$.validator.clearError=function(e){var t=$(e).attr("id")+"-error";var r=null;if($(e).parents("form").size()>0){r=$(e).parents("form").find("[id='"+t+"']")}else{r=document.getElementById("[id='"+t+"']")}$(e).removeClass("error");if($(r).size()>0){$(r).remove()}};function getValue(e,t,r){var a=this.settings.rules[$(t).attr("name")];if(a&&a["default"]){return $(t).val()}return e}$.validator.addMethod("default",function(e,t,r){if(e==undefined||e==null||e==""){$(t).val(r)}return true});$.validator.addMethod("required",function(e,t,r){e=getValue.call(this,e,t,r);if(typeof r=="object"){var a=false;if(r.requiredValue===undefined){var i=typeof e=="string"||e instanceof String;if(r.strict&&e!==undefined||!r.strict&&!pub.isEmpty(i?$.trim(e):e)){a=true}if(r.strict&&e!==undefined){a=true}if(!r.strict&&!pub.isEmpty(i?$.trim(e):e)){a=true}if(!this.depend(r,t)){return"dependency-mismatch"}if(t.nodeName.toLowerCase()==="select"){var n=$(t).val();a=n&&n.length>0}if(this.checkable(t)){a=this.getLength(e,t)>0}}else if(!r.strict&&e==r.requiredValue||r.strict&&e===r.requiredValue){a=true}return a}else{if(!this.depend(r,t)){return"dependency-mismatch"}if(t.nodeName.toLowerCase()==="select"){var n=$(t).val();return n&&n.length>0}if(this.checkable(t)){return this.getLength(e,t)>0}return e.length>0}},"不能为空！");$.validator.addMethod("boolean",function(e,t,r){e=getValue.call(this,e,t,r);if(typeof r=="object"){var a=!r.strict&&(e==r.trueValue||e==r.falseValue)||r.strict&&(e===r.trueValue||e===r.falseValue);return a}else{return typeof e=="boolean"}});$.validator.addMethod("ajax",function(e,t,r){if(!r){console.error("无效的exist验证器参数！");return}e=getValue.call(this,e,t,r);if(e==undefined||e==null||e==""){e=""}if(this.optional(t)){return"dependency-mismatch"}var a=this.previousValue(t),i,n;if(!this.settings.messages[t.name]){this.settings.messages[t.name]={}}a.originalMessage=this.settings.messages[t.name].remote;this.settings.messages[t.name].remote=a.message;if(a.old===e){return a.valid}a.old=e;i=this;this.startRequest(t);var s=r.url;var l=r.model;var o=r.params;var n={model:r.model,attribute:r.attribute,scenario:r.scenario};n[t.name]=e;for(var u in o){var f=o[u];n[f]=$("[name='"+f+"']").val()}$.ajax({url:s,mode:"abort",port:"validate"+t.name,dataType:"json",data:n,context:i.currentForm,success:function(r){var n=r.code==0||r==true||r==="true",s,l,o;i.settings.messages[t.name].remote=a.originalMessage;if(n){o=i.formSubmitted;i.prepareElement(t);i.formSubmitted=o;i.successList.push(t);delete i.invalid[t.name];i.showErrors()}else{setMessage.call(i,t,"ajax",r.message);s={};l=r.message||i.defaultMessage(t,"ajax");s[t.name]=a.message=$.isFunction(l)?l(e):l;i.invalid[t.name]=true;i.showErrors(s)}a.valid=n;i.stopRequest(t,n);var u=$(t).data("rule-ajax-callback");if($.isFunction(u)){u.call(t,r)}}});return"pending"});$.validator.addMethod("string",function(e,t,r){e=getValue.call(this,e,t,r);return typeof e=="string"});$.validator.addMethod("minlength",function(e,t,r){e=getValue.call(this,e,t,r);var a=$.isArray(e)?e.length:this.getLength(e,t);return this.optional(t)||a>=r});$.validator.addMethod("maxlength",function(e,t,r){e=getValue.call(this,e,t,r);var a=$.isArray(e)?e.length:this.getLength(e,t);return this.optional(t)||a<=r});$.validator.addMethod("length",function(e,t,r){e=getValue.call(this,e,t,r);var a=$.isArray(e)?e.length:this.getLength(e,t);return this.optional(t)||a==r});$.validator.addMethod("number",function(e,t,r){e=getValue.call(this,e,t,r);return this.optional(t)||/^\s*[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?\s*$/.test(e)});$.validator.addMethod("integer",function(e,t,r){e=getValue.call(this,e,t,r);return this.optional(t)||/^\s*[+-]?\d+\s*$/.test(e)});$.validator.addMethod("max",function(e,t,r){e=getValue.call(this,e,t,r);return this.optional(t)||e<=r});$.validator.addMethod("min",function(e,t,r){e=getValue.call(this,e,t,r);return this.optional(t)||e>=r});$.validator.addMethod("in",function(e,t,r){if(!r.allowArray&&$.isArray(e)){return false}var a=r.range?r.range:r;var i=true;$.each($.isArray(e)?e:[e],function(e,t){if($.inArray(t,a)==-1){i=false;return false}else{return true}});return i});$.validator.addMethod("notin",function(e,t,r){if(!r.allowArray&&$.isArray(e)){return false}var a=r.range?r.range:r;var i=true;$.each($.isArray(e)?e:[e],function(e,t){if($.inArray(t,a)==-1){i=false;return false}else{return true}});return!i});$.validator.addMethod("match",function(e,t,r){if(!r){console.error("无效的正则表达式验证器参数！");return}e=getValue.call(this,e,t,r);if(r.skipOnEmpty&&pub.isEmpty(e)){return true}if(!r.not&&!e.match(r.pattern)||r.not&&e.match(r.pattern)){return false}return true});$.validator.addMethod("username",function(e,t,r){if(!r){console.error("无效的正则表达式验证器参数！");return}e=getValue.call(this,e,t,r);if(r.skipOnEmpty&&pub.isEmpty(e)){return true}if(!e.match(r.pattern)){return false}return true});$.validator.addMethod("password",function(e,t,r){if(!r){console.error("无效的正则表达式验证器参数！");return}e=getValue.call(this,e,t,r);if(r.skipOnEmpty&&pub.isEmpty(e)){return true}if(!r.not&&!e.match(r.pattern)||r.not&&e.match(r.pattern)){return false}return true});$.validator.addMethod("email",function(e,t,r){e=getValue.call(this,e,t,r);if(typeof r=="object"){if(r.skipOnEmpty&&pub.isEmpty(e)){return true}var a=true;if(r.enableIDN){var i=/^(.*<?)(.*)@(.*)(>?)$/,n=i.exec(e);if(n===null){a=false}else{e=n[1]+punycode.toASCII(n[2])+"@"+punycode.toASCII(n[3])+n[4]}}if(!a||!(e.match(r.pattern)||r.allowName&&e.match(r.fullPattern))){return false}return true}else{return this.optional(t)||/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(e)}});$.validator.addMethod("url",function(e,t,r){e=getValue.call(this,e,t,r);if(typeof r=="object"){if(r.skipOnEmpty&&pub.isEmpty(e)){return true}if(r.defaultScheme&&!e.match(/:\/\//)){e=r.defaultScheme+"://"+e}var a=true;if(r.enableIDN){var i=/^([^:]+):\/\/([^\/]+)(.*)$/,n=i.exec(e);if(n===null){a=false}else{e=n[1]+"://"+punycode.toASCII(n[2])+n[3]}}if(!a||!e.match(r.pattern)){return false}return true}else{return this.optional(t)||/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[\/?#]\S*)?$/i.test(e)}});$.validator.addMethod("trim",function(e,t,r){var e=$(t).val();if(!r.skipOnEmpty||!pub.isEmpty(e)){$(t).val($.trim(e))}return true});$.validator.addMethod("captcha",function(e,t,r){if(!r){console.error("无效的captcha验证器参数！");return}e=getValue.call(this,e,t,r);if(r.skipOnEmpty&&pub.isEmpty(e)){return}var a=$("body").data(r.hashKey);if(a==null){a=r.hash}else{a=a[r.caseSensitive?0:1]}var i=r.caseSensitive?e:e.toLowerCase();for(var n=i.length-1,s=0;n>=0;--n){s+=i.charCodeAt(n)}if(s!=a){return false}return true});$.validator.addMethod("compare",function(e,t,r){if(!r){console.error("无效的compare验证器参数！");return}e=getValue.call(this,e,t,r);if(r.skipOnEmpty&&pub.isEmpty(e)){return true}var a,i=true;if(r.compareAttribute===undefined){a=r.compareValue}else{var n=$("#"+r.compareAttribute);if($(t).data("compare-to")){n=$($(t).data("compare-to"))}a=$(n).val();if($(n).size()==0){console.error("元素 ID:"+r.compareAttribute+" 不存在！");return false}}if(r.type==="number"){e=parseFloat(e);a=parseFloat(a)}else if(r.type==="date"){e=new Date(e.replace(/-/g,"/")).getTime();a=new Date(a.replace(/-/g,"/")).getTime()}switch(r.operator){case"==":i=e==a;break;case"===":i=e===a;break;case"!=":i=e!=a;break;case"!==":i=e!==a;break;case">":i=e>a;break;case">=":i=e>=a;break;case"<":i=e<a;break;case"<=":i=e<=a;break;default:i=false;break}$(t).data("is-compared",true);if(i){try{if($("#"+r.compareAttribute).data("is-compared")!=true){$("#"+r.compareAttribute).valid()}}catch(s){}}else{$(t).data("is-compared",false)}return i});$.validator.addMethod("file",function(e,t,r){if(!r||typeof r!="object"){if(this.settings.debug){console.error("无效的file验证器参数！")}return true}var a=getUploadedFiles.call(this,t,r);if(a==false){return false}var i=this;var n=true;$.each(a,function(e,a){n=validateFile.call(i,a,t,r);if(n==false){return false}});return n});$.validator.addMethod("image",function(e,t,r){if(!r){console.error("无效的image验证器参数！");return}var a=getUploadedFiles.call(this,t,r);if(a==false){return false}var i=this;var n=deferredArray();$.each(a,function(e,a){if(!validateFile.call(i,a,t,r)){return false}if(typeof FileReader==="undefined"){return true}var s=$.Deferred(),l=new FileReader,o=new Image;o.onload=function(){if(r.minWidth&&this.width<r.minWidth){var e=r.underWidth.replace(/\{file\}/g,a.name);s.resolve(false,e);return}if(r.maxWidth&&this.width>r.maxWidth){var e=r.overWidth.replace(/\{file\}/g,a.name);s.resolve(false,e);return}if(r.minHeight&&this.height<r.minHeight){var e=r.underHeight.replace(/\{file\}/g,a.name);s.resolve(false,e);return}if(r.maxHeight&&this.height>r.maxHeight){var e=r.overHeight.replace(/\{file\}/g,a.name);s.resolve(false,e);return}s.resolve(true)};o.onerror=function(){var e=r.notImage.replace(/\{file\}/g,a.name);s.resolve(false,e)};l.onload=function(){o.src=l.result};l.onerror=function(){s.resolve(false,r.message)};l.readAsDataURL(a);n.push(s)});if(this.optional(t)){return"dependency-mismatch"}var s=this.previousValue(t);if(!this.settings.messages[t.name]){this.settings.messages[t.name]={}}s.originalMessage=this.settings.messages[t.name].remote;this.settings.messages[t.name].remote=s.message;if(s.old===e){return s.valid}s.old=e;this.startRequest(t);$.when.apply(this,n).always(function(r,a){var n,l;if(r){l=i.formSubmitted;i.prepareElement(t);i.formSubmitted=l;i.successList.push(t);delete i.invalid[t.name];i.showErrors()}else{n={};n[t.name]=s.message=$.isFunction(a)?a(e):a;i.invalid[t.name]=true;i.showErrors(n)}s.valid=r;i.stopRequest(t,r)});return"pending"});function getUploadedFiles(e,t){if(typeof File==="undefined"){return true}var r=$(e).get(0).files;if(!r){setMessage.call(this,e,"file",t.message);return false}if(r.length===0){if(!t.skipOnEmpty){setMessage.call(this,e,"file",t.uploadRequired);return false}}if(t.maxFiles&&t.maxFiles<r.length){setMessage.call(this,e,"file",t.tooMany);return false}return r}function validateFile(e,t,r){if(r.extensions&&r.extensions.length>0){var a,i;a=e.name.lastIndexOf(".");if(!~a){i=""}else{i=e.name.substr(a+1,e.name.length).toLowerCase()}if(!~r.extensions.indexOf(i)){setMessage.call(this,t,"file",r.wrongExtension.replace(/\{file\}/g,e.name));return false}}if(r.mimeTypes&&r.mimeTypes.length>0){if(!~r.mimeTypes.indexOf(e.type)){setMessage.call(this,t,"file",r.wrongMimeType.replace(/\{file\}/g,e.name));return false}}if(r.maxSize&&r.maxSize<e.size){setMessage.call(this,t,"file",r.tooBig.replace(/\{file\}/g,e.name));return false}if(r.minSize&&r.minSize>e.size){setMessage.call(this,t,"file",r.tooSmall.replace(/\{file\}/g,e.name));return false}return true}function setMessage(e,t,r){this.settings.messages[e.name][t]=r}function showError(e,t,r,a){this.formatAndAdd(e,{method:"image",parameters:r});this.invalid[e.name]=true;$(e).attr("aria-invalid",true);if(!this.numberOfInvalids()){this.toHide=this.toHide.add(this.containers)}var i={};i[e.name]=a;this.showErrors(i)}$.validator.addRules=function(rules,options){if(typeof rules=="string"){try{rules=$.parseJSON(rules)}catch(e){rules=eval(rules)}}var defaults={attribute:"name",form:undefined};options=$.extend(defaults,options);for(var i=0;i<rules.length;i++){try{var id=rules[i].id;var name=rules[i].name;var attribute=rules[i].attribute;var rule=rules[i].rules;var element;if(options.mapping){if(options.mapping[attribute]&&options.mapping[attribute]["id"]){id=options.mapping[attribute]["id"]}if(options.mapping[attribute]&&options.mapping[attribute]["name"]){name=options.mapping[attribute]["name"]}}if(options.attribute=="id"){element="#"+id}else{element="[name='"+name+"']:input"}if(options.form){element=$(options.form).find(element)}else if($.isFunction($(element).rules)){element=$(element)}$(element).rules("add",rule)}catch(e){console.error(rules[i])}}};$.fn.addRule=function(rule){if(typeof rule=="string"){try{rule=$.trim(rule);rule=$.parseJSON(rule)}catch(e){rule=eval(rule)}}var rules=[];if($.isArray(rule)){rules=rule}else{rules=[rule]}for(var i=0;i<rules.length;i++){$(this).each(function(){$(this).rules("add",rules[i])})}}})(jQuery);